## 1，文件上传及其管理

文件上传、下载等文件管理的核心服务类是`UploadFileService`接口，在需要使用的地方自动装配即可使用：

```java
@Autowired
private UploadFileService uploadFileService;
```

该接口中包含的方法如下：

```java
/**
 * 上传文件并保存
 *
 * @param uploadFile 上传的文件对象
 * @return 文件结果，包含上传的文件信息
 */
FileResult<UploadFile> upload(MultipartFile uploadFile);

/**
 * 删除已上传文件
 *
 * @param filename 要删除的文件名
 * @return 文件结果
 */
FileResult<Void> delete(String filename);

/**
 * 查找文件并获取，不使用扩展名
 *
 * @param filename 文件名（不带扩展名）
 * @return 文件结果，包含对应的文件信息
 */
FileResult<UploadFile> findByMainName(String filename);

/**
 * 根据文件的完整名称直接获取文件
 * 在已知文件名及其扩展名的情况下推荐使用本方法直接获取到文件，在文件系统储存时使用该方法可以避免查找文件的性能消耗
 *
 * @param fullName 文件全名（需要包含扩展名）
 * @return 文件结果，包含对应的文件信息
 */
FileResult<UploadFile> findByFullName(String fullName);

/**
 * 根据文件名查找并下载对应文件，得到文件流
 *
 * @param filename 文件名（不带扩展名）
 * @return 文件结果
 */
FileResult<BinaryContent> downloadFileByMainName(String filename);

/**
 * 根据文件的完整名称直接获取对应文件并下载，得到文件流
 * 在已知文件名及其扩展名的情况下推荐使用本方法直接获取到文件，在文件系统储存时使用该方法可以避免查找文件的性能消耗
 *
 * @param fullName 文件全名（需要包含扩展名）
 * @return 文件结果
 */
FileResult<BinaryContent> downloadFileByFullName(String fullName);
```

只需要调用对应的方法，我们就可以完成文件的上传、管理了！是不是非常方便呢？

在此我们也发现：所有的方法都返回了一个`FileResult`对象，这是框架中自带的一个表示文件操作结果对象，其中包含了如下信息：

- 是否操作成功
- 成功/失败的消息
- 操作得到的内容（例如查询到的文件信息，或者下载文件时的文件二进制内容）

后面，我们再来详细地探讨一下这个结果对象。

### (1) 文件上传

文件上传接收的是`MultipartFile`类型的请求体，前端使用`form-data`表单上传文件即可接收。

这里给出一个简单的网页示例实现文件上传：

```html
<!DOCTYPE html>
<html>

<head>
	<meta charset="utf-8" />
	<title>文件上传简单示例</title>
</head>

<body>
	<!-- 文件上传表单 -->
	<!-- action换成自己的文件上传接口地址 -->
	<form enctype="multipart/form-data" method="POST" action="/upload">
		<input type="file" name="image" />
		<input type="submit" value="upload" />
	</form>
</body>

</html>
```

可见这里有一个`<input type="file" name="image" />`标签，是用于指定上传文件的，其`name`属性是`image`，表示上传的**文件名参数**，这个值要和**后端接口中的参数名一致**，例如下：

```java
@PostMapping("/upload")
public FileResult<UploadFile> upload(@RequestParam("image") MultipartFile file) {
	return uploadFileService.upload(file);
}
```

可见这里使用类型为`MultipartFile`类型参数接收上传的文件，使用`@RequestParam`指定该参数名为`image`，这要和表单中`file`类型的`input`标签的`name`属性值一致。

除此之外，前端还可以使用JavaScript代码写一个上传文件逻辑，例如：

```javascript
// 获取file类型的input标签的DOM
let input = document.querySelector('input');
// 获取input标签DOM中选择的待上传文件，其属性files就表示选择的文件数组，如果是单文件就指定下标0即可
let file = input.files[0];

// 新建表单对象
let form = new FormData();
// 向表单添加文件，文件名参数为image
form.append('image', file);
// 发起请求上传文件
fetch(requestURL, {
	method: 'POST',
	// 请求体设定为表单对象
	body: form
}).then((response) => {
	return response.json();
}).then((result) => {
	// 请求完成后对结果的处理
	console.log(result);
});
```

### (2) 查找文件信息

接口中`findByMainName`和`findByFullName`都能够查询已上传的文件的信息，注意这不是下载文件，只是查询对应文件的信息，例如文件名等等。

那这两个方法有什么区别呢？很显然：

- `findByMainName` 根据文件名查询信息，**不需要传递文件扩展名**，更加简洁
- `findByFullName` 根据完整文件名查询信息，**需要包含文件扩展名**

例如现在上传了个文件，并被命名为`abc.jpg`，那么通过`findByMainName`，传入`abc`即可找到该文件。那使用`findByFullName`函数呢？就需要传入`abc.jpg`了！